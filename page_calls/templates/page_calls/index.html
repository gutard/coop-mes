{% load thumbnail %}


<div class="main-content">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <form id="annuaires-search" method="GET" action="#" class="content-box top advanced-search-form">
                    {{ form.non_field_errors }}
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="item">
                                <h3>Donneur d'ordre</h3>
                                <div class="dropdown">
                                    {{ form.org_type }}
                                </div>
                            </div>
                            <div class="item">
                                <h3>Clauses</h3>
                                <div class="dropdown checkboxes clauses-dropdown">
                                    <button type="button" class="btn dropdown-toggle" data-toggle="dropdown">
                                        Clauses
                                    </button>
                                    {{ form.clauses }}
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="item">
                                <h3>Organisation</h3>
                                <div class="dropdown">
                                    {{ form.organization }}
                                </div>
                            </div>
                            <div class="item">
                                <h3>Secteurs d'activités</h3>
                                <div class="dropdown checkboxes sectors-dropdown">
                                    <button type="button" class="btn dropdown-toggle" data-toggle="dropdown">
                                        Clauses
                                    </button>
                                    {{ form.sectors }}
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="item">
                                <h3>Période de publication</h3>
                                <div class="dropdown">
                                    {{ form.period }}
                                </div>
                            </div>
                            <div class="item">
                                <h3>Recherche libre</h3>
                                <div class="dropdown">
                                    {{ form.q }}
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="item">
                                <div class="result">
                                    <span class="number">{{ calls.paginator.count }}</span> Résultat{{ calls.paginator.count|pluralize }}
                                </div>
                            </div>
                            <div class="item">
                                <p class="text-center"><input class="btn btn-default" type="submit" name="display" value="RECHERCHER"></p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-9">
                <div class="content-box">
{% if calls %}
                    <div class="section-head">
                        {% include "page_calls/pagination.html" %}
                    </div>
                    <div class="results">
{% for call in calls %}
                        <div class="media">
                            <a class="pull-left" href="#">
                            {% if call.organization.logo %}
                                {% thumbnail call.organization.logo "220x140" upscale=0 as logo %}
                                    <img class="media-object" src="{{ logo.url }}" style="padding: {{ logo|margin:"220x140" }}" width="220" height="140" />
                                {% endthumbnail %}
                            {% else %}
                                <img class="media-object" src="" width="220" height="140">
                            {% endif %}
                            </a>
                            <div class="media-body">
                                <p class="activity">{{ call.activities_links }}</p>
                                <h4 class="media-heading">{{ call.title }}</h4>
                                <p>Date limite de remise des offres&nbsp;: {{ call.deadline|date:"j F Y à G\hi" }}</p>
                                <a href="{{ call.get_absolute_url }}?{{ get_params }}&page={{ calls.number }}" class="btn btn-default">Détails de l'offre</a>
                            </div>
                        </div>
{% endfor %}
                    </div>
                    <div class="section-foot">
                        {% include "page_calls/pagination.html" %}
                    </div>
{% else %}
                    <p>Aucun résultat.</p>
{% endif %}
                </div>
            </div>
            <div class="col-lg-3 sidebar sidebar--right">
                {% include "right-menu.html" %}
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function clauses_click() {
        var clauses = [];
        $('.clauses-dropdown input:checked').each(function() {
            clauses.push($(this).val());
        });
        if (clauses.length == 0)
            clauses = 'Tout voir';
        else
            clauses = clauses.join(', ');
        $('.clauses-dropdown button').html(clauses);
    }
    function sectors_click() {
        var sectors = [];
        $('.sectors-dropdown input:checked').each(function() {
            sectors.push($(this).parent().text());
        });
        if (sectors.length == 0)
            sectors = 'Tout voir';
        else
            sectors = sectors.join(', ');
        $('.sectors-dropdown button').html(sectors);
    }
    $('.clauses-dropdown input').click(clauses_click);
    $('.sectors-dropdown input').click(sectors_click);
    clauses_click();
    sectors_click();
</script>
